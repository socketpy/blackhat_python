#!/use/bin/python
"""
Use of CookieJar to share session with multible Browser instance for SPSE exercise 4.5
"""

import mechanize

cj = mechanize.CookieJar()
br1 = mechanize.Browser()
br1.set_cookiejar(cj)
br1.open('http://localhost/dvwa/login.php')

print "Title in browser 1: " + br1.title()
br1.select_form(nr=0)
br1.form['username'] = 'admin'
br1.form['password'] = 'password'
print "[*] Logging into DVWA"
br1.submit()
print "Title in browser 1: " + br1.title()
sessid = br1._ua_handlers['_cookies'].cookiejar[0].value
print "[*] Cookie updated br1: PHPSESSID=" + sessid

print "[*] Creating new browser"
br2 = mechanize.Browser()
br2.set_cookiejar(cj)
br2.open('http://localhost/dvwa/')
print "Title in browser 2: " + br2.title()
print "[*] Cookie updated br2: PHPSESSID=" + sessid
