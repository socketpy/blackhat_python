#!/usr/bin/python
"""showing the progress of downloading a large file from internet using urllib.urlretrieve - for exercise 4.1"""

import urllib, sys, getopt, time
from progressbar import ProgressBar

p=ProgressBar(100)

def usage():
    print "Usage: ./download_progress.py <url1> <url2> ... <urln>"

def dlProgress(count, blockSize, totalSize):
    percent = int(count*blockSize*100/totalSize)
    if percent >= 100:
        sys.stdout.write("\r100% - Download Completed\n")
        sys.stdout.flush()
    else:
        sys.stdout.write("\r%2d%%" % percent)
        sys.stdout.flush()

def progress(count, blockSize, totalSize):
    percent = int(count*blockSize*100/totalSize)
    if percent >= 100:
        p.finish()
    else:
        p.update(percent)
    

def main(argv):
    global p
    try:
        opts, args = getopt.getopt(argv, "h")
    except getopt.GetoptError:
        usage()
        sys.exit(2)

    for opt, arg in opts:
        if opt in ("-h"):
            usage()
            sys.exit()

    if len(args) < 1:
        usage()
        sys.exit(2)

    i = 1
    for url in args:
        print "Downloading: ", url
        try:
            urllib.urlretrieve(url, str(i), reporthook=progress)
        except:
            print "Error during download of ", url

        i += 1

    
if __name__ == '__main__':
    main(sys.argv[1:])
